name: Docker-Builder

on:
    workflow_dispatch:
        inputs:
            tag:
                description: "Tag to apply to the Docker image"
                required: true
                default: "latest"
                type: choice
                options:
                    - latest
                    - beta
                    - stable

jobs:
    Publish_Image:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up Docker Compose
              run: |
                  sudo apt-get update
                  sudo apt-get install -y docker-compose

            - name: Build image
              run: docker build -t ${{ secrets.DOCKER_USERNAME }}/bedrock-server:${{ github.event.inputs.tag || 'latest' }} .

            - name: Push image
              run: |
                  echo "${{ secrets.DOCKER_TOKEN }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin
                  docker push ${{ secrets.DOCKER_USERNAME }}/bedrock-server:${{ github.event.inputs.tag || 'latest' }}
